# Process Injection Techniques
- [DLL Injection](#dll-injection)
  * [1. Classical DLL Injection](#1-classical-dll-injection)
  * [2. Reflective DLL Injection](#2-reflective-dll-injection)
- [PE Injection](#pe-injection)
  * [How it works](#how-it-works)
- [Process Hollowing (Process Replacement / RunPE)](#process-hollowing--process-replacement---runpe-)
  * [How it works](#how-it-works-1)
- [Thread Execution Hijacking](#thread-execution-hijacking)
- [Injection via Hooks (SetWindowsHookEx)](#injection-via-hooks--setwindowshookex-)
- [Injection via Registry Modifications](#injection-via-registry-modifications)
- [APC Injection](#apc-injection)
- [Extra Window Memory Injection](#extra-window-memory-injection)
- [Early Bird API Injection](#early-bird-api-injection)
- [API Hooking](#api-hooking)

## DLL Injection
### 1. Classical DLL Injection
* where malware writes the path of its DLL into the address space of a legitimate process and creates a remote thread in the targeted process to guarantee that the remote process will load the injected code.
* One way to achieve this is to use the `Import Adder` function in `CFF Explorer`
* Downside of this technique is that a malicious DLL has to be on disk, and thus not stealthy.

### 2. Reflective DLL Injection

## PE Injection
* Malware copies its malicious code into an existing process and runs it using shellcode or by calling CreateRemoteThread.
* Advantange of this technqiue is that it does not require a malicious DLL on the disk.

### How it works

## Process Hollowing (Process Replacement / RunPE)
* Malware unmaps or hollows out the code of a legitimate process from memory and overwrites the memory space of the victim process by its malicious code.

### How it works

## Thread Execution Hijacking
* also known as Suspend, Inject and Resume (SIR).
* This injection method inject malicous code into the existing thread of a process to avoid the overhead of process and thread creation and then uses the target to start a thread in itself.
* A problem may arise in SIR approach as suspending a process and resuming it during a system call may crash the system but this can be circumvented by resuming and trying later.

## Injection via Hooks (SetWindowsHookEx)
* 

## Injection via Registry Modifications


## APC Injection
* Is the exploitation of Asynchronous Procedure Calls(APC) to impose legitimate threads to execute malicious code.
* Since every thread is associated with a queue of APCs that wait for execution when the thread enters in alterable state.
* This is done by attaching malicious code to the APC Queue of the target thread. 
* AtomBombing technique is one of the technique that depends on APC injection but uses the atom table to write into the memory space of another thread


## Extra Window Memory Injection
* EWMI injection relies on injecting code into `Explorer Tray Windows's Extra Window Memory`
* 

* Malware family that uses this technique : PowerLoader and Gapz 

## Early Bird API Injection
* this malware injects malicious code into target processes before the main thread starts, thus evading detectino by most AV products which uses Windows hook engine.
* This technique is used by "TurnedUp" backdoor, "Carberp" and "DorkBot" malware.

## API Hooking
* is the interception of Windows API calls to modify the input or output of the commands.
* Usually used to steal passwords, prevent loading of security tools, hijack network connections, key logging and hiding processes or files.
